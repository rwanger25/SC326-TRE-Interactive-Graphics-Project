---
output: flexdashboard::flex_dashboard
runtime: shiny
---

```{r global, include=FALSE, warning=FALSE, message=FALSE}
library(httr2)
library(purrr)
library(tibble)
library(lubridate)
library(dplyr)
library(ggplot2)
library(shiny)
library(tidyr)
library(plotly)
```

What Activities Put You at the Highest Risk of Shark Attacks?
=====================================  

Column {.sidebar}
-----------------------------------------------------------------------

```{r}
radioButtons("gender_button", label = "Select Gender", choices = c("All" = "all", "Female" = "female", "Male" = "male"))
radioButtons("age_button", label = "Select Age Range", choices = c("All" = "all", "0-9" = "0-9", "10-19" = "10-19", "20-29" = "20-29", "30-39" = "30-39", "40-49" = "40-49", "50-59" = "50-59", "60+" = "60+"))
```

Column
-----------------------------------------------------------------------

### What Activities Put You at the Highest Risk of Shark Attacks?

```{r}
sharks_act <- read.csv("Australian Shark-Incident Database Public Version.csv")

sharks_act <- sharks_act %>%
  select(Victim.activity, Victim.gender, Victim.age)
sharks_act$age <- cut(sharks_act$Victim.age, breaks = c(0, 10, 20, 30, 40, 50, 60, Inf), labels = c("0-9", "10-19", "20-29", "30-39", "40-49", "50-59", "60+"), right = FALSE)

sharks_act <- sharks_act[-which(sharks_act$Victim.activity == ""), ]
sharks_act[sharks_act == "boarding"] <- "Boarding"
sharks_act[sharks_act == "diving"] <- "Diving"
sharks_act[sharks_act == "diving, collecting"] <- "Diving"
sharks_act[sharks_act == "fishing"] <- "Fishing"
sharks_act[sharks_act == "motorised boating"] <- "Boating"
sharks_act[sharks_act == "other: hull scraping"] <- "Other"
sharks_act[sharks_act == "other: jetskiing; swimming"] <- "Other"
sharks_act[sharks_act == "other: standing in water"] <- "Standing in Water"
sharks_act[sharks_act == "other:floating"] <- "Swimming"
sharks_act[sharks_act == "paddleboarding"] <- "Boarding"
sharks_act[sharks_act == "snorkeling"] <- "Snorkeling"
sharks_act[sharks_act == "snorkelling"] <- "Snorkeling"
sharks_act[sharks_act == "spearfishing"] <- "Spearfishing"
sharks_act[sharks_act == "surfing"] <- "Boarding"
sharks_act[sharks_act == "swimming"] <- "Swimming"
sharks_act[sharks_act == "unmotorised boating"] <- "Boating"
sharks_act[sharks_act == "wing foiler"] <- "Other"

renderPlotly({
  if(input$gender_button == "all")
    {
    sharks_act_filtered_v1 <- sharks_act
    }
  if(input$gender_button == "female")
    {
    sharks_act_filtered_v1 <- sharks_act %>%
      filter(Victim.gender == "female")
    }
  if(input$gender_button == "male")
    {
    sharks_act_filtered_v1 <- sharks_act %>%
      filter(Victim.gender == "male")
    }
  if(input$age_button == "all")
    {
    sharks_act_filtered <- sharks_act_filtered_v1
    }
  if(input$age_button == "0-9")
    {
    sharks_act_filtered <- sharks_act_filtered_v1 %>%
      filter(age == "0-9")
    }
  if(input$age_button == "10-19")
    {
    sharks_act_filtered <- sharks_act_filtered_v1 %>%
      filter(age == "10-19")
    }
    if(input$age_button == "20-29")
    {
    sharks_act_filtered <- sharks_act_filtered_v1 %>%
      filter(age == "20-29")
    }
    if(input$age_button == "30-39")
    {
    sharks_act_filtered <- sharks_act_filtered_v1 %>%
      filter(age == "30-39")
    }
    if(input$age_button == "40-49")
    {
    sharks_act_filtered <- sharks_act_filtered_v1 %>%
      filter(age == "40-49")
    }
    if(input$age_button == "50-59")
    {
    sharks_act_filtered <- sharks_act_filtered_v1 %>%
      filter(age == "50-59")
    }
    if(input$age_button == "60+")
    {
    sharks_act_filtered <- sharks_act_filtered_v1 %>%
      filter(age == "60+")
    }
  p_act <- ggplot(sharks_act_filtered, aes(x = Victim.activity)) + geom_bar() + labs(x = "Activity", y = "Number of Shark Attacks")
  ggplotly(p_act)})
```

When Should You Swim?
=====================================  

Column {.sidebar}
-----------------------------------------------------------------------

```{r}
radioButtons("time_button", label = "By Month or Time of Day?", choices = c("Month" = "month", "Time of Day" = "hour"))
```

Column
-----------------------------------------------------------------------

### When Should You Swim?

```{r}
sharks_time <- read.csv("Australian Shark-Incident Database Public Version.csv")

sharks_time <- sharks_time %>%
  select(Incident.month, Time.of.incident)

sharks_time$Time.of.incident <- floor(as.numeric(sharks_time$Time.of.incident) / 100) * 100

sharks_time_month <- sharks_time %>%
  group_by(Incident.month) %>%
  summarise(count_month = n())

sharks_time_hour <- sharks_time %>%
  group_by(Time.of.incident) %>%
  summarise(count_hour = n())

for (n in seq(0, 2300, by = 100))
{
  if (!n %in% sharks_time_hour$Time.of.incident)
  {
    sharks_time_hour <- rbind(sharks_time_hour, c(n, 0))
  }
}

sharks_time_hour <- sharks_time_hour %>%
  drop_na(Time.of.incident)

renderPlotly({
  if(input$time_button == "month")
    {
    p_time <- ggplot(sharks_time_month, aes(x = Incident.month, y = count_month)) + geom_point() + geom_line() + labs(x = "Month", y = "Number of Shark Attacks")
    }
  else
    {
    p_time <- ggplot(sharks_time_hour, aes(x = Time.of.incident, y = count_hour)) + geom_point() + geom_line() + labs(x = "Time of Day", y = "Number of Shark Attacks")
    }
  ggplotly(p_time)
  })
```